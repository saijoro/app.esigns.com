import{H3Event as T,getRequestHeaders as z,getResponseStatus as U,getRequestURL as Q,getRequestWebStream as J,getResponseHeaders as V,eventHandler as G}from"h3";import{getContext as Z}from"unctx";import{AsyncLocalStorage as K}from"node:async_hooks";import{isPlainArray as X,isPlainObject as P,createControlledPromise as Y,defer as ee,useRouter as _,pick as te,ScriptOnce as w,RouterProvider as re,createMemoryHistory as ne,useRouterState as y,createRootRouteWithContext as oe,ScrollRestoration as se,Outlet as ae,createFileRoute as $,lazyRouteComponent as q,lazyFn as ie,createRouter as ue}from"@tanstack/react-router";import{jsxs as f,Fragment as p,jsx as u}from"react/jsx-runtime";import*as S from"react";import{createElement as L,createContext as ce}from"react";import g from"jsesc";import le from"tiny-invariant";import{Transform as de,PassThrough as me}from"node:stream";import{isbot as H}from"isbot";import x from"react-dom/server";import{Context as I}from"@tanstack/react-cross-context";import{QueryClient as fe}from"@tanstack/react-query";import{routerWithQueryClient as pe}from"@tanstack/react-router-with-query";function he(e,t,r){if(!r.router.isServer)return t;r.match.extracted=r.match.extracted||[];const n=r.match.extracted;return b(t,(s,a)=>{const i=s instanceof ReadableStream?"stream":s instanceof Promise?"promise":void 0;if(i){const c={dataType:e,type:i,path:a,id:n.length,value:s,matchIndex:r.match.index};if(n.push(c),i==="stream"){const[l,d]=s.tee();return c.streamState=Re({stream:d}),l}else ee(s)}return s})}function _e(e){const t=_(),r=t.state.matches[e.matchIndex];if(!t.isServer)return null;const n=r.extracted,[o,s]=["__beforeLoadContext","loaderData"].map(a=>n?n.reduce((i,c)=>c.dataType!==a?C(i,["temp",...c.path],void 0):i,{temp:r[a]}).temp:r[a]);if(o!==void 0||s!==void 0||n?.length){const a=`__TSR__.initMatch(${g({index:e.matchIndex,__beforeLoadContext:t.options.transformer.stringify(o),loaderData:t.options.transformer.stringify(s),extracted:n?Object.fromEntries(n.map(i=>[i.id,te(i,["type","path"])])):{}},{isScriptContext:!0,wrap:!0,json:!0})})`;return f(p,{children:[u(w,{children:a}),n?n.map(i=>i.type==="stream"?u(ge,{entry:i},i.id):u(ye,{entry:i},i.id)):null]})}return null}function b(e,t,r=[]){if(X(e))return e.map((o,s)=>b(o,t,[...r,`${s}`]));if(P(e)){const o={};for(const s in e)o[s]=b(e[s],t,[...r,s]);return o}const n=t(e,r);return n!==e?n:e}function ye({entry:e}){return u("div",{className:"tsr-once",children:u(S.Suspense,{fallback:null,children:u(Se,{entry:e})})})}function Se({entry:e}){const t=_();if(e.value.status==="pending")throw e.value;const r=`__TSR__.resolvePromise(${g(e,{isScriptContext:!0,wrap:!0,json:!0})})`;return t.injectScript(r),u(p,{})}function ge({entry:e}){le(e.streamState,"StreamState should be defined");const t=_();return u(k,{streamState:e.streamState,children:r=>{const n=r?`__TSR__.matches[${e.matchIndex}].extracted[${e.id}].value.controller.enqueue(new TextEncoder().encode(${g(r.toString(),{isScriptContext:!0,wrap:!0,json:!0})}))`:`__TSR__.matches[${e.matchIndex}].extracted[${e.id}].value.controller.close()`;return t.injectScript(n),u(p,{})}})}function Re({stream:e}){const t={promises:[]},r=e.getReader(),n=o=>(t.promises[o]=Y(),r.read().then(({done:s,value:a})=>{if(s){t.promises[o].resolve(null),r.releaseLock();return}return t.promises[o].resolve(a),n(o+1)}));return n(0).catch(o=>{console.error("stream read error",o)}),t}function k({streamState:e,children:t,__index:r=0}){const n=e.promises[r];if(!n)return null;if(n.status==="pending")throw n;const o=n.value;return f(p,{children:[t(o),u("div",{className:"tsr-once",children:u(S.Suspense,{fallback:null,children:u(k,{streamState:e,__index:r+1,children:t})})})]})}function C(e,t,r){if(t.length===0)return r;const[n,...o]=t;return Array.isArray(e)?e.map((s,a)=>a===Number(n)?C(s,o,r):s):P(e)?{...e,[n]:C(e[n],o,r)}:e}function E(e){e.router.AfterEachMatch=_e,e.router.serializer=n=>g(n,{isScriptContext:!0,wrap:!0,json:!0});const t=I.get("TanStackRouterHydrationContext",{}),r=S.useMemo(()=>{var n,o;return{router:e.router.dehydrate(),payload:(o=(n=e.router.options).dehydrate)==null?void 0:o.call(n)}},[e.router]);return u(t.Provider,{value:r,children:u(re,{router:e.router})})}function xe(e){let t;const r=D(e),n={duplex:"half",method:e.method,headers:e.headers};return e.node.req.body instanceof ArrayBuffer?new Request(r,{...n,body:e.node.req.body}):new Request(r,{...n,get body(){return t||(t=Ce(e),t)}})}function ve(e){return e.web??={request:xe(e),url:D(e)},e.web.request}function Te(){return Ee()}const A=Symbol("$HTTPEvent");function we(e){return typeof e=="object"&&(e instanceof T||e?.[A]instanceof T||e?.__is_event__===!0)}function R(e){return function(...t){let r=t[0];if(we(r))t[0]=r instanceof T||r.__is_event__?r:r[A];else{if(!globalThis.app.config.server.experimental?.asyncContext)throw new Error("AsyncLocalStorage was not enabled. Use the `server.experimental.asyncContext: true` option in your app configuration to enable it. Or, pass the instance of HTTPEvent that you have as the first argument to the function.");if(r=Te(),!r)throw new Error("No HTTPEvent found in AsyncLocalStorage. Make sure you are using the function within the server runtime.");t.unshift(r)}return e(...t)}}const wt=R(z),D=R(Q),bt=R(U),be=R(V),Ce=R(J);function He(){return Z("nitro-app",{asyncContext:!!globalThis.app.config.server.experimental?.asyncContext,AsyncLocalStorage:K})}function Ee(){return He().use().event}function Me(e){return e instanceof Headers?new Headers(e):Array.isArray(e)?new Headers(e):typeof e=="object"?new Headers(e):new Headers}function M(...e){return e.reduce((t,r)=>{const n=Me(r);for(const[o,s]of n.entries())t.set(o,s);return t},new Headers)}function Pe({createRouter:e,getRouterManifest:t}){return r=>G(async n=>{const o=ve(n),s=new URL(o.url),a=s.href.replace(s.origin,""),i=ne({initialEntries:[a]}),c=e();c.serializeLoaderData=he,t&&(c.manifest=t()),c.update({history:i}),await c.load();const l=$e({event:n,router:c});return await r({request:o,router:c,responseHeaders:l})})}function $e(e){e.event.__tsrHeadersSent=!0;let t=M(be(e.event),{"Content-Type":"text/html; charset=UTF-8"},...e.router.state.matches.map(n=>n.headers));const{redirect:r}=e.router.state;return r&&(t=M(t,r.headers,{Location:r.href})),t}function qe(e){const t=W(()=>e.injectedHtml.map(r=>r()).join(""));return new de({transform(r,n,o){t.transform(r,this.push.bind(this)).then(()=>o()).catch(s=>o(s))},flush(r){t.flush(this.push.bind(this)).then(()=>r()).catch(n=>r(n))}})}function Le(e){const t=W(()=>e.injectedHtml.map(n=>n()).join("")),r=new TextEncoder;return new TransformStream({transform(n,o){return t.transform(n,s=>(o.enqueue(r.encode(s)),!0))},flush(n){return t.flush(o=>(n.enqueue(o),!0))}})}const Ie=/(<body)/,ke=/(<\/body>)/,Ae=/(<\/html>)/,De=/(<\/[a-zA-Z][\w:.-]*?>)/g,We=new TextDecoder;function W(e){let t=!1,r="",n="";return{async transform(o,s){const a=r+We.decode(o),i=a.match(Ie),c=a.match(ke),l=a.match(Ae);try{if(i&&(t=!0),!t){s(a),r="";return}const d=e();if(c&&l&&c.index<l.index){const m=c.index+c[0].length,h=l.index+l[0].length,v=a.slice(0,m)+d+a.slice(m,h)+a.slice(h);s(v),r=""}else{let m,h=0;for(;(m=De.exec(a))!==null;)h=m.index+m[0].length;if(h>0){const v=a.slice(0,h)+d+n;s(v),r=a.slice(h)}else r=a,n+=d}}catch(d){throw console.error("Error transforming HTML:",d),d}},async flush(o){r&&o(r)}}}const Be=async({request:e,router:t,responseHeaders:r})=>{if(typeof x.renderToReadableStream=="function"){const n=await x.renderToReadableStream(u(E,{router:t}),{signal:e.signal});H(e.headers.get("User-Agent"))&&await n.allReady;const s=[Le(t)].reduce((a,i)=>a.pipeThrough(i),n);return new Response(s,{status:t.state.statusCode,headers:r})}if(typeof x.renderToPipeableStream=="function"){const n=new me,o=x.renderToPipeableStream(u(E,{router:t}),{...H(e.headers.get("User-Agent"))?{onAllReady(){o.pipe(n)}}:{onShellReady(){o.pipe(n)}},onError:(i,c)=>{console.log("Error in renderToPipeableStream:",i,c)}}),a=[qe(t)].reduce((i,c)=>i.pipe(c),n);return new Response(a,{status:t.state.statusCode,headers:r})}throw new Error("No renderToReadableStream or renderToPipeableStream found in react-dom/server. Ensure you are using a version of react-dom that supports streaming.")},Fe=()=>({routes:{__root__:{filePath:"__root.tsx",children:["/_layout"],preloads:["\\_build\\assets\\client-D_FFMy6y.js","\\_build\\assets\\client-ChOrW0Tx.js"]},"/_layout":{filePath:"_layout.tsx",children:["/_layout/"]},"/_layout/":{filePath:"_layout/index.tsx",parent:"/_layout"}}});function Oe(e){return globalThis.MANIFEST[e]}function Ne(){const e=Fe(),t=e.routes.__root__=e.routes.__root__||{};t.assets=t.assets||[];const r=Oe("client");return t.assets.push({tag:"script",attrs:{src:r.inputs[r.handler]?.output.path,type:"module",async:!0,suppressHydrationWarning:!0}}),e}function je(){const e=Ne();return{...e,routes:Object.fromEntries(Object.entries(e.routes).map(([t,r])=>{const{preloads:n,assets:o}=r;return[t,{preloads:n,assets:o}]}))}}function B({tag:e,attrs:t,children:r}){switch(e){case"title":return u("title",{...t,suppressHydrationWarning:!0,children:r});case"meta":return u("meta",{...t,suppressHydrationWarning:!0});case"link":return u("link",{...t,suppressHydrationWarning:!0});case"style":return u("style",{...t,dangerouslySetInnerHTML:{__html:r}});case"script":return t&&t.src?u("script",{...t,suppressHydrationWarning:!0}):typeof r=="string"?u("script",{...t,dangerouslySetInnerHTML:{__html:r},suppressHydrationWarning:!0}):null;default:return null}}const ze=()=>{const e=_(),t=y({select:s=>s.matches.map(a=>a.meta).filter(Boolean)}),r=S.useMemo(()=>{const s=[],a={};let i;return[...t].reverse().forEach(c=>{[...c].reverse().forEach(l=>{if(l.title)i||(i={tag:"title",children:l.title});else{if(l.name){if(a[l.name])return;a[l.name]=!0}s.push({tag:"meta",attrs:{...l}})}})}),i&&s.push(i),s.reverse(),s},[t]),n=y({select:s=>s.matches.map(a=>a.links).filter(Boolean).flat(1).map(a=>({tag:"link",attrs:{...a}})),structuralSharing:!0}),o=y({select:s=>{const a=[];return s.matches.map(i=>e.looseRoutesById[i.routeId]).forEach(i=>{var c,l,d;return(d=(l=(c=e.manifest)==null?void 0:c.routes[i.id])==null?void 0:l.preloads)==null?void 0:d.filter(Boolean).forEach(m=>{a.push({tag:"link",attrs:{rel:"modulepreload",href:m}})})}),a},structuralSharing:!0});return Je([...r,...o,...n],s=>JSON.stringify(s))},Ue=()=>{const e=_(),t=ze(),r=S.useContext(I.get("TanStackRouterHydrationContext",{}));return f(p,{children:[t.map((n,o)=>L(B,{...n,key:`tsr-meta-${JSON.stringify(n)}`})),f(p,{children:[u(w,{log:!1,children:'__TSR__={matches:[],streamedValues:{},queue:[],runQueue:()=>{let e=!1;__TSR__.queue=__TSR__.queue.filter((_=>!_()||(e=!0,!1))),e&&__TSR__.runQueue()},initMatch:e=>{__TSR__.queue.push((()=>(__TSR__.matches[e.index]||(__TSR__.matches[e.index]=e,Object.entries(e.extracted).forEach((([e,_])=>{if("stream"===_.type){let e;_.value=new ReadableStream({start(_){e=_}}),_.value.controller=e}else if("promise"===_.type){let e,t;_.value=new Promise(((_,u)=>{e=_,t=u})),_.resolve=e,_.reject=t}}))),!0))),__TSR__.runQueue()},resolvePromise:e=>{__TSR__.queue.push((()=>{const _=__TSR__.matches[e.matchIndex];if(_){const t=_.extracted[e.id];if(t)return t.resolve(e.value.data),!0}return!1})),__TSR__.runQueue()},cleanScripts:()=>{document.querySelectorAll(".tsr-once").forEach((e=>{e.remove()}))}};'}),u(w,{children:`__TSR__.dehydrated = ${g(e.options.transformer.stringify(r),{isScriptContext:!0,wrap:!0,json:!0})}`})]})]})},Qe=()=>u(p,{children:Ue()});function Je(e,t){const r=new Set;return e.filter(n=>{const o=t(n);return r.has(o)?!1:(r.add(o),!0)})}const Ve=()=>{const e=_(),t=y({select:o=>{const s=[];return o.matches.map(a=>e.looseRoutesById[a.routeId]).forEach(a=>{var i,c,l;return(l=(c=(i=e.manifest)==null?void 0:i.routes[a.id])==null?void 0:c.assets)==null?void 0:l.filter(d=>d.tag==="script").forEach(d=>{s.push({tag:"script",attrs:d.attrs,children:d.children})})}),s},structuralSharing:!0}),{scripts:r}=y({select:o=>({scripts:o.matches.map(s=>s.scripts).filter(Boolean).flat(1).map(({children:s,...a})=>({tag:"script",attrs:{...a,suppressHydrationWarning:!0},children:s}))})}),n=[...r,...t];return u(p,{children:n.map((o,s)=>L(B,{...o,key:`tsr-scripts-${o.tag}-${s}`}))})},Ge=ce({appData:{dashboard:{pathname:""}}}),Ze=({children:e})=>{const t=window.location.pathname;return u(Ge.Provider,{value:{appData:{dashboard:{pathname:t}}},children:e})},Ke="/_build/assets/app-BT3BuD0z.css",F=oe()({context:()=>Ze,head:()=>({meta:[{charSet:"utf-8"},{name:"viewport",content:"width=device-width, initial-scale=1"},{title:"TanStarter"}]}),component:Xe});function Xe(){return u(Ye,{children:u(ae,{})})}function Ye({children:e}){return f("html",{children:[f("head",{children:[u(Qe,{}),u("link",{rel:"stylesheet",href:Ke})]}),f("body",{children:[e,u(se,{}),u(Ve,{})]})]})}const et=()=>import("./_layout-C2Z6N0Kw.js"),O=$("/_layout")({component:q(et,"component",()=>O.ssr)}),tt=()=>import("./index-xf7AXn-T.js"),rt=()=>import("./index-xf7AXn-T.js"),N=$("/_layout/")({component:q(rt,"component",()=>N.ssr),loader:ie(tt,"loader")}),j=O.update({id:"/_layout",getParentRoute:()=>F}),nt=N.update({id:"/",path:"/",getParentRoute:()=>j}),ot={LayoutIndexRoute:nt},st=j._addFileChildren(ot),at={LayoutRoute:st},it=F._addFileChildren(at)._addFileTypes(),ut=()=>f("div",{children:[u("h1",{children:"404"}),u("p",{children:"Not Found"})]});function ct(){const e=new fe;return pe(ue({routeTree:it,context:{queryClient:e},defaultPreload:"intent",defaultNotFoundComponent:ut}),e)}const Ct=Pe({createRouter:ct,getRouterManifest:je})(Be);export{N as R,bt as a,Ee as b,wt as c,Oe as g,Ct as h,M as m,ve as t};
